(()=>{let e=null,t=null,i=null,a=null,w=[],n=0;ext.runtime.onExtensionClick.addListener((async()=>{const d=w.findIndex((e=>!e.isCreated));-1===d&&n++,t=await ext.windows.create({title:`TLDraw #${d>=0?d+1:n}`,icon:"icons/icon-1024.png",fullscreenable:!0,vibrancy:!1,frame:!0}),e=await ext.tabs.create({icon:"icons/icon-1024.png",text:`TLDraw #${d>=0?d+1:n}`,muted:!0,mutable:!1,closable:!0}),a=await ext.websessions.create({partition:`TLDraw ${d>=0?d+1:n}`,persistent:!0,cache:!0,global:!1});const s=await ext.windows.getContentSize(t.id);i=await ext.webviews.create({websession:a});let o=await ext.windows.getPlatformDarkMode()?"setDarkMode":"setLightMode";await ext.webviews.executeJavaScript(i.id,`window.dispatchEvent(new Event('${o}'))`),await ext.webviews.loadURL(i.id,"https://www.tldraw.com"),await ext.webviews.attach(i.id,t.id),await ext.webviews.setBounds(i.id,{x:0,y:0,width:s.width,height:s.height}),await ext.webviews.setAutoResize(i.id,{width:!0,height:!0}),d>=0?w[d]={tabObject:e,windowObject:t,webviewObject:i,isCreated:!0}:w.push({tabObject:e,windowObject:t,webviewObject:i,isCreated:!0}),d=-1})),ext.windows.onUpdatedDarkMode.addListener((async(e,t)=>{const i=t.platform?"setDarkMode":"setLightMode";for(let e of w)await ext.webviews.executeJavaScript(e.webviewObject.id,`window.dispatchEvent(new Event('${i}'))`)})),ext.tabs.onClicked.addListener((async e=>{w.forEach((async t=>{t.tabObject.id==e.id&&(await ext.windows.restore(t.windowObject.id),await ext.windows.focus(t.windowObject.id))}))})),ext.tabs.onClickedClose.addListener((async e=>{w.forEach((async(t,i)=>{t.tabObject.id==e.id&&(await ext.tabs.remove(t.tabObject.id),await ext.windows.remove(t.windowObject.id),await ext.webviews.remove(t.webviewObject.id),t.tabObject=null,t.windowObject=null,t.webviewObject=null,t.isCreated=!1)}))})),ext.windows.onClosed.addListener((async e=>{w.forEach((async(t,i)=>{t.windowObject.id==e.id&&(await ext.tabs.remove(t.tabObject.id),await ext.webviews.remove(t.webviewObject.id),t.tabObject=null,t.windowObject=null,t.webviewObject=null,t.isCreated=!1)}))}))})();